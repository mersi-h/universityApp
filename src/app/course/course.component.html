<div fxLayout="row">
    <mat-form-field fxFlex="80" fxLayoutAlign="center center" appearance="outline" style="margin-top: 10px;">
        <mat-label translate>{{'Search' | translate}}</mat-label>
        <input matInput (keyup.enter)="search($event.target.value)" placeholder="{{'Search-by-name' | translate}}">
        <!-- <button *ngIf="value" matSuffix mat-icon-button aria-label="Clear" (click)="value=''">
            <mat-icon>close</mat-icon>
          </button> -->
    </mat-form-field>
    <button *ngIf="role=='ADMIN'" style="margin-top: 20px;" fxLayoutAlign="end center" mat-icon-button color="dark" (click)="addCourse()">
        <mat-icon style="font-size:xx-large;" inline="true" matTooltip="{{'Add-course' | translate}}">library_add</mat-icon>
    </button>
</div>
<div class="table-container">
<table mat-table [dataSource]="dataSource" matSort class="mat-elevation-z8">

    <ng-container matColumnDef="position">
        <th width="10%" mat-header-cell *matHeaderCellDef mat-sort-header translate>{{'No.' | translate}}</th>
        <td mat-cell *matCellDef="let i=index"> {{i+1}} </td>
    </ng-container>

    <!-- Name Column -->
    <ng-container matColumnDef="name">
        <th width="20%" mat-header-cell *matHeaderCellDef mat-sort-header translate>{{'Name' | translate}}</th>
        <td mat-cell *matCellDef="let element"> {{element.name}} </td>
    </ng-container>

    <!-- Description Column -->
    <ng-container matColumnDef="description">
        <th width="15%" mat-header-cell *matHeaderCellDef mat-sort-header>{{'Description' | translate}}</th>
        <td mat-cell *matCellDef="let element"> {{element.description}} </td>
    </ng-container>

    <!-- University Column -->
    <ng-container matColumnDef="universityName">
        <th width="20%" mat-header-cell *matHeaderCellDef mat-sort-header>{{'University-Name' | translate}} </th>
        <td mat-cell *matCellDef="let element"> {{element.universityName}} </td>
    </ng-container>

    <!-- Date Column -->
    <ng-container matColumnDef="date">
        <th width="10%" mat-header-cell *matHeaderCellDef mat-sort-header> {{'Date' | translate}} </th>
        <td mat-cell *matCellDef="let element"> {{element.date | date:'short'}} </td>
    </ng-container>

    <!-- Symbol Column -->
    <ng-container matColumnDef="location">
        <th width="10%" mat-header-cell *matHeaderCellDef mat-sort-header > {{'Location' | translate}} </th>
        <td mat-cell *matCellDef="let element"> {{element.location}} </td>
    </ng-container>

    <!-- Actions Column -->
    <ng-container *ngIf="role=='ADMIN'" matColumnDef="actions">
        <th width="15%" mat-header-cell *matHeaderCellDef>{{'Actions' | translate}}</th>
        <td mat-cell *matCellDef="let element">
            <button mat-icon-button color="dark" (click)="editCourseDialog(element,editCourseTemplate)">
                <mat-icon aria-label="Edit">edit</mat-icon>
            </button>
            <button mat-icon-button color="warn" (click)="deleteCourseDialog(element,deleteTemplate)">
                <mat-icon aria-label="Delete">delete</mat-icon>
            </button>
        </td>
    </ng-container>
    <ng-container *ngIf="role=='USER'" matColumnDef="actions">
        <th width="15%" mat-header-cell *matHeaderCellDef>{{'Actions' | translate}}</th>
        <td mat-cell *matCellDef="let element" >
            <button  *ngIf="userCourses.length==0 || !userCourses.includes(element.name)"
            mat-button color="dark" (click)="joinCourse(element.name)">
            {{'JOIN' | translate}}
            </button>
            <button  *ngIf="userCourses.length!=0 && userCourses.includes(element.name)"
            mat-button color="warn" (click)="leaveCourseDialog(element.name,leaveCourseTemplate)" translate>
            {{'LEAVE' | translate}}
            </button>
            <button mat-icon-button color="dark" (click)="courseDetails(element.name)">
                <mat-icon matTooltip="{{'Course-details' | translate}}">description</mat-icon>
            </button>
        </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
</table>
</div>
<mat-paginator [pageSize]="size" [pageIndex]="page" [length]="length" [pageSizeOptions]="[1,5, 10, 20,50,100]"
    (page)="handlePage($event)" showFirstLastButtons>
</mat-paginator>

<!--ADD COURSE TEMPLATE-->
<ng-template #addCourseDialog>
    <div fxLayout="row" fxLayoutAlign="space-between center" class="modalHeater"
        style="font-size: 20px; font-weight: 600; font-family: Proxima Nova; margin: 10px; font-family: Proxima Nova; text-align: center;">
        <div fxFlex="90">{{'Add-course' | translate}}</div>
        <div fxFlex="10">
            <button (click)="closeDialog()" style="float:right" mat-icon-button color="dark">
                <mat-icon>close</mat-icon>
            </button>
        </div>
    </div>
    <mat-divider></mat-divider>
    <br>
    <form [formGroup]="createForm" (ngSubmit)="createCourse(createForm)">
        <div fxLayout="row">
            <div fxFlex="50">
                <mat-form-field appearance="outline">
                    <mat-label translate>Name</mat-label>
                    <input formControlName="name" required autocomplete="new-name" matInput
                        placeholder="{{'Enter-course-name' | translate}}">
                </mat-form-field>
            </div>
            <div fxFlex="50">
                <mat-form-field appearance="outline">
                    <mat-label>{{'Select-a-university' | translate}}</mat-label>
                    <mat-select name="universityName" id="universityName" required formControlName="universityName">
                        <mat-option *ngFor="let university of universities" [value]="university.name">
                            {{university.name}}</mat-option>
                    </mat-select>
                </mat-form-field>
            </div>
        </div>
        <div fxLayout="row">
            <div fxFlex="50">
                <mat-form-field appearance="outline">
                    <mat-label>{{'Description' | translate}}</mat-label>
                    <input formControlName="description" required autocomplete="new-description" matInput
                        placeholder="{{'Enter-description' | translate}}">
                </mat-form-field>
            </div>
        </div>
        <div fxLayout="row">
            <div fxFlex="50">
                <mat-form-field appearance="outline">
                    <mat-label>{{'Location' | translate}}</mat-label>
                    <input formControlName="location" required autocomplete="new-location" matInput
                        placeholder="{{'Enter-location' | translate}}">
                </mat-form-field>
            </div>
            <div fxFlex="50">
                <mat-form-field appearance="outline">
                    <mat-label >{{'Choose-a-date' | translate}}</mat-label>
                    <input type="datetime-local" formControlName="date" matInput [min]="minDate" >
                </mat-form-field>
            </div>
        </div>
        <div fxLayout="row" fxLayoutAlign="space-between center">
            <div fxFlex="50">
                <mat-form-field appearance="outline">
                    <mat-label>{{'Latitude' | translate}}</mat-label>
                    <input formControlName="latitude" required autocomplete="new-latitude" matInput
                        placeholder="{{'Enter-latitude' | translate}}">
                </mat-form-field>
            </div>
            <div fxFlex="50">
                <mat-form-field appearance="outline">
                    <mat-label >{{'Longitude' | translate}}</mat-label>
                    <input formControlName="longitude" required autocomplete="new-longitude" matInput
                        placeholder="{{'Enter-longitude' | translate}}">
                </mat-form-field>
            </div>
        </div>
        <div fxLayout="row">
            <div fxFlex="100" fxLayoutAlign="center center">
                <button type="submit" mat-button color="dark">{{'Submit' | translate}}</button>
            </div>
        </div>
    </form>
  </ng-template>
  <!--EDIT COURSE TEMPLATE-->
<ng-template #editCourseTemplate>
    <div fxLayout="row" fxLayoutAlign="space-between center" class="modalHeater" 
    style="font-size: 20px; font-weight: 600; font-family: Proxima Nova; 
    margin: 10px; font-family: Proxima Nova; text-align: center;">
      <div fxFlex="90">Edit course</div>
      <div fxFlex="10">
        <button (click)="closeDialog()" style="float:right" mat-icon-button color="primary">
          <mat-icon>close</mat-icon>
        </button>
      </div>
    </div>
    <mat-divider style="margin-left: 10px; margin-right: 10px"></mat-divider>
    <br>
    <form [formGroup]="createForm" (ngSubmit)="editCourse(createForm)">
        <div fxLayout="row">
            <div fxFlex="50">
                <mat-form-field appearance="outline">
                    <mat-label>{{'Name' | translate}}</mat-label>
                    <input formControlName="name" matInput
                        placeholder="{{'Enter-course-name' | translate}}">
                </mat-form-field>
            </div>
            <div fxFlex="50">
                <mat-form-field appearance="outline">
                    <mat-label>{{'Select-a-university' | translate}}</mat-label>
                    <mat-select name="universityName" id="universityName" required formControlName="universityName">
                        <mat-option *ngFor="let university of universities" [value]="university.name">
                            {{university.name}}</mat-option>
                    </mat-select>
                </mat-form-field>
            </div>
        </div>
        <div fxLayout="row">
            <div fxFlex="50">
                <mat-form-field appearance="outline">
                    <mat-label>{{'Description' | translate}}</mat-label>
                    <input formControlName="description" required autocomplete="new-description" matInput
                        placeholder="{{'Enter-description' | translate}}">
                </mat-form-field>
            </div>
        </div>
        <div fxLayout="row">
            <div fxFlex="50">
                <mat-form-field appearance="outline">
                    <mat-label>{{'Location' | translate}}</mat-label>
                    <input formControlName="location" required autocomplete="new-location" matInput
                        placeholder="{{'Enter-location' | translate}}">
                </mat-form-field>
            </div>
            <div fxFlex="50">
                <mat-form-field appearance="outline">
                    <mat-label >{{'Choose-a-date' | translate}}</mat-label>
                    <input type="datetime-local" formControlName="date" matInput [min]="minDate" >
                </mat-form-field>
            </div>
        </div>
        <div fxLayout="row" fxLayoutAlign="space-between center">
            <div fxFlex="50">
                <mat-form-field appearance="outline">
                    <mat-label>{{'Latitude' | translate}}</mat-label>
                    <input formControlName="latitude" required autocomplete="new-latitude" matInput
                        placeholder="{{'Enter-latitude' | translate}}">
                </mat-form-field>
            </div>
            <div fxFlex="50">
                <mat-form-field appearance="outline">
                    <mat-label>{{'Longitude' | translate}}</mat-label>
                    <input formControlName="longitude" required autocomplete="new-longitude" matInput
                        placeholder="{{'Enter-longitude'}}">
                </mat-form-field>
            </div>
        </div>
        <div fxLayout="row">
            <div fxFlex="100" fxLayoutAlign="center center">
                <button type="submit" mat-button color="primary">{{'Submit' | translate}}</button>
            </div>
        </div>
    </form>
  </ng-template>

<!--DELETE TEMPLATE-->
<ng-template #deleteTemplate>
    <mat-dialog-content style="font-size: 16px" translate>Are-you-sure-you-want-to-delete-this-course?</mat-dialog-content>
    <mat-dialog-actions style="justify-content: center">
        <button color="warn" mat-button mat-dialog-close (click)="deleteCourse(courseToBeDeleted.name)" >{{'Yes' | translate}}</button>
        <button mat-button mat-dialog-close>{{'No' | translate}}</button>
    </mat-dialog-actions>
</ng-template>

<!--LEAVE COURSE TEMPLATE-->
<ng-template #leaveCourseTemplate>
    <mat-dialog-content style="font-size: 16px" translate>Are-you-sure-you-want-to-leave-this-course?</mat-dialog-content>
    <mat-dialog-actions style="justify-content: center">
        <button color="warn" mat-button mat-dialog-close (click)="leaveCourse(courseName)" >{{'Yes' | translate}}</button>
        <button mat-button mat-dialog-close>{{'No' | translate}}</button>
    </mat-dialog-actions>
</ng-template>
